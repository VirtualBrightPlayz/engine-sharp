<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Engine Sharp</title>
    <base href="/" />
</head>

<body>
    <canvas width="600" height="400" id="canvas"></canvas>

    <script type="text/javascript">
        var canvas = document.getElementById("canvas");
        var Module = {
            canvas: canvas,
            onRuntimeInitialized: () => {
                console.log("onRuntimeInitialized");
            },
        };

        window.init = () => {
            window.requestAnimationFrame(frame);
            return 0;
        };

        window.getHttpPrefix = () => {
            return window.location.protocol + "//" + window.location.host;
        };

        window.getHttpContent = (path) => {
            var request = new XMLHttpRequest();
            request.open("GET", path, false);
            request.send(null);
            return request.response;
        };

        function frame(time) {
            DotNet.invokeMethodAsync("Web", "Frame", time).then(code => {
                console.log("Frame finished.");
                window.requestAnimationFrame(frame);
            }).catch(err => {
                console.error(err);
            });
        }

        function runEngine() {
            console.log("Init...");
            DotNet.invokeMethodAsync("Web", "Init").then(code => {
                console.log("Init finished.");
            });
        }
        document.addEventListener("DOMContentLoaded", function() {
            Blazor.start();
        });
    </script>

    <button onclick="runEngine();">Start</button>

    <script src="_framework/blazor.webassembly.js" autostart="false"></script>
</body>
</html>
